---
import type { Page } from 'astro';

import { ExternalLinkIcon } from '@radix-ui/react-icons';

import type { UnifiedPost } from '@/types/unified-post';

import Pagination from '@/components/AstroPagination.astro';
import { DateComponent } from '@/components/date';
import NotFound from '@/components/NotFound.astro';
import { Badge } from '@/components/ui/badge';

export type Props = {
  page: Page<UnifiedPost>;
  title?: string;
};
const { page, title } = Astro.props;
---

<>
  <div class="py-4">
    <div class="flex items-center justify-between pb-8">
      {title && <h1 class="font-heading capitalize">{title}</h1>}
    </div>
    <ul class="space-y-8">
      {
        page.data.length === 0 ? (
          <NotFound />
        ) : (
          page.data.map((post) => {
            const isZenn = post.type === 'zenn';
            const tags = post.tags ?? [];
            // Compare only the date portion to ignore time differences
            const dateOnly = post.date.toISOString().slice(0, 10);
            const lastUpdatedOnly = post.lastUpdated
              ?.toISOString()
              .slice(0, 10);
            const hasDistinctUpdate =
              !!lastUpdatedOnly && lastUpdatedOnly !== dateOnly;

            return (
              <li>
                <article class="group">
                  <span class="flex items-center justify-start gap-2 align-middle">
                    {isZenn ? (
                      <Badge className="capitalize" variant="outline">
                        <span class="mr-1">{post.emoji}</span>
                        zenn
                      </Badge>
                    ) : (
                      <a
                        class="pb-0.5"
                        href={`/blog/categories/${post.category}`}
                      >
                        <Badge className="capitalize" variant="secondary">
                          {post.category}
                        </Badge>
                      </a>
                    )}
                    <DateComponent type="published" date={post.date} />
                    {hasDistinctUpdate && post.lastUpdated && (
                      <DateComponent type="updated" date={post.lastUpdated} />
                    )}
                  </span>
                  <a
                    href={post.url}
                    target={isZenn ? '_blank' : '_self'}
                    rel={isZenn ? 'noopener noreferrer' : undefined}
                  >
                    <h2 class="font-heading transition-colors duration-normal group-hover:text-link">
                      {post.title}
                      {isZenn && (
                        <ExternalLinkIcon className="ml-1 inline-block size-4 opacity-50" />
                      )}
                    </h2>
                  </a>
                  {tags.length > 0 && (
                    <div class="flex flex-wrap gap-2 pt-1">
                      {tags.map((tag) =>
                        isZenn ? (
                          <span class="text-xs text-muted-foreground">
                            #{tag}
                          </span>
                        ) : (
                          <a
                            href={`/blog/tags/${tag}`}
                            class="text-xs text-muted-foreground transition-colors hover:text-foreground"
                          >
                            #{tag}
                          </a>
                        ),
                      )}
                    </div>
                  )}
                </article>
              </li>
            );
          })
        )
      }
    </ul>
    <div class="pt-12">
      <Pagination page={page} />
    </div>
  </div>
</>
