---
import ModeToggle from '@/components/ModeToggle.astro';

const url = Astro.url;

const navItems = [
  { href: '/', label: 'Home', match: (p: string) => p === '/' },
  { href: '/blog', label: 'Blog', match: (p: string) => p.includes('/blog') },
  {
    href: '/portfolio',
    label: 'Portfolio',
    match: (p: string) => p.includes('/portfolio'),
  },
] as const;
---

<header
  id="site-header"
  class="bg-background/80 sticky top-0 z-50 w-full px-4 backdrop-blur-md transition-[border-color,box-shadow] duration-200"
>
  <nav class="mx-auto flex max-w-4xl items-center justify-between py-2">
    <a href="/" class="font-code text-foreground text-sm tracking-wide">
      funailog
    </a>
    <div class="flex items-center gap-1">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'hover:bg-accent hover:text-accent-foreground rounded-md px-3 py-1.5 text-xs transition-colors',
              item.match(url.pathname)
                ? 'text-foreground font-medium'
                : 'text-muted-foreground',
            ]}
          >
            {item.label}
          </a>
        ))
      }
      <div class="border-border ml-1 border-l pl-1">
        <ModeToggle />
      </div>
    </div>
  </nav>
</header>

<script>
  function initHeaderScroll() {
    const header = document.getElementById('site-header');
    if (!header) return;

    let ticking = false;

    const updateHeader = () => {
      const scrollY = window.scrollY;

      if (scrollY > 20) {
        header.classList.add('border-b', 'border-border', 'shadow-sm');
      } else {
        header.classList.remove('border-b', 'border-border', 'shadow-sm');
      }

      ticking = false;
    };

    const onScroll = () => {
      if (!ticking) {
        window.requestAnimationFrame(updateHeader);
        ticking = true;
      }
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    updateHeader();
  }

  initHeaderScroll();
  document.addEventListener('astro:after-swap', initHeaderScroll);
</script>
