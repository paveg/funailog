---
import { HomeIcon, Pencil2Icon, PersonIcon } from '@radix-ui/react-icons';

import ButtonLink from '@/components/ButtonLink.astro';
import { ModeToggle } from '@/components/mode-toggle';
import { cn } from '@/lib/utils';
const url = Astro.url;
---

<header
  id="site-header"
  class="bg-background/80 sticky top-0 z-50 w-full px-4 backdrop-blur-md transition-[border-color,box-shadow] duration-200"
>
  <nav id="global" class="mx-auto max-w-4xl py-2">
    <div class="flex w-full grow">
      <div class="mr-auto">
        <ModeToggle client:only="react" />
      </div>
      <div class="flex justify-end">
        <ButtonLink
          aria-label="Go to Home page"
          variant="ghost"
          size="sm"
          class={cn(
            'gap-2 rounded-lg',
            url.pathname === '/' && 'text-link-active',
          )}
          href="/"
        >
          <HomeIcon className="size-4" />
          <span class="hidden sm:block">Home</span>
        </ButtonLink>
        <ButtonLink
          aria-label="Go to Blog page"
          variant="ghost"
          size="sm"
          class={cn(
            'gap-2 rounded-lg',
            url.pathname.includes('/blog') && 'text-link-active',
          )}
          href="/blog"
        >
          <Pencil2Icon className="size-4" />
          <span class="hidden sm:block">Blog</span>
        </ButtonLink>
        <ButtonLink
          aria-label="Go to Portfolio page"
          variant="ghost"
          size="sm"
          class={cn(
            'gap-2 rounded-lg',
            url.pathname.includes('/portfolio') && 'text-link-active',
          )}
          href="/portfolio"
        >
          <PersonIcon className="size-4" />
          <span class="hidden sm:block">Portfolio</span>
        </ButtonLink>
      </div>
    </div>
  </nav>
</header>

<script>
  function initHeaderScroll() {
    const header = document.getElementById('site-header');
    if (!header) return;

    let ticking = false;

    const updateHeader = () => {
      const scrollY = window.scrollY;

      if (scrollY > 20) {
        header.classList.add('border-b', 'border-border', 'shadow-sm');
      } else {
        header.classList.remove('border-b', 'border-border', 'shadow-sm');
      }

      ticking = false;
    };

    const onScroll = () => {
      if (!ticking) {
        window.requestAnimationFrame(updateHeader);
        ticking = true;
      }
    };

    window.addEventListener('scroll', onScroll, { passive: true });

    // Initial check
    updateHeader();
  }

  // Run on initial load
  initHeaderScroll();

  // Re-run after Astro page transitions
  document.addEventListener('astro:after-swap', initHeaderScroll);
</script>
