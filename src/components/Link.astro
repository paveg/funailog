---
import LinkCard from '@/components/LinkCard.astro';
import { defaultLang } from '@/i18n/ui';
import { useTranslations } from '@/i18n/utils';
import { cn, linkStyles } from '@/lib/utils';

type Props = {
  href: string;
  ['data-linkcard']?: string;
};

const props = Astro.props;
const t = useTranslations(defaultLang);
const isInternal = props.href.startsWith('/');
const isAnchor = props.href.startsWith('#');
const linkClass = cn(linkStyles.base, linkStyles.inline);
---

{
  Object.hasOwn(props, 'data-linkcard') ? (
    <LinkCard {...props}>
      <slot />
    </LinkCard>
  ) : isAnchor || isInternal ? (
    <a href={props.href} class={linkClass}>
      <slot />
    </a>
  ) : (
    <a
      target="_blank"
      rel="noopener noreferrer"
      href={props.href}
      class:list={[linkClass, 'external-link']}
      aria-label={`${props.href} (${t('a11y.externalLink')})`}
    >
      <slot />
    </a>
  )
}

<style>
  .external-link::after {
    content: '';
    display: inline-block;
    width: 0.7em;
    height: 0.7em;
    margin-left: 0.1em;
    vertical-align: baseline;
    opacity: 0.4;
    transition: opacity 150ms;
    background-color: currentColor;
    mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M7 17L17 7'/%3E%3Cpath d='M7 7h10v10'/%3E%3C/svg%3E");
    mask-size: contain;
    mask-repeat: no-repeat;
  }
  .external-link:hover::after {
    opacity: 0.8;
  }
</style>
