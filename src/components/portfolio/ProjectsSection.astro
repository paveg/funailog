---
import { ExternalLinkIcon, GitHubLogoIcon } from '@radix-ui/react-icons';

import type { SupportedLang } from '@/config/site';
import type { Project } from '@/schemas/portfolio-collection';

import { Badge } from '@/components/ui/badge';
import { useTranslations } from '@/i18n/utils';

interface Props {
  items: Project[];
  lang?: SupportedLang;
}

const { items, lang = 'ja' } = Astro.props;
const t = useTranslations(lang);

const typeLabels: Record<Project['type'], Record<SupportedLang, string>> = {
  work: { ja: '業務', en: 'Work' },
  personal: { ja: '個人', en: 'Personal' },
  oss: { ja: 'OSS', en: 'OSS' },
};

const getAriaLabel = (name: string, type: 'site' | 'repo') => {
  if (lang === 'en') {
    return type === 'site' ? `Open ${name} website` : `Open ${name} repository`;
  }
  return type === 'site'
    ? `${name}のサイトを開く`
    : `${name}のリポジトリを開く`;
};
---

<section class="space-y-4 sm:space-y-5">
  <h2 class="font-heading text-lg font-semibold sm:text-xl">
    {t('portfolio.projects')}
  </h2>
  <div class="grid gap-3 sm:grid-cols-2">
    {
      items.map((project) => (
        <div class="border-border/50 bg-card/50 group flex flex-col gap-2 rounded-xl border p-3 transition-all hover:border-border hover:shadow-sm sm:p-4">
          <div class="flex flex-col gap-1.5 sm:flex-row sm:items-center sm:justify-between sm:gap-2">
            <div class="flex flex-wrap items-center gap-1.5 sm:gap-2">
              <span class="text-sm font-medium sm:text-base">
                {project.name}
              </span>
              <Badge variant="category" className="text-2xs sm:text-xs">
                {typeLabels[project.type][lang]}
              </Badge>
            </div>
            <div class="flex items-center gap-1">
              {project.url && (
                <a
                  href={project.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="rounded-md p-1 text-muted-foreground transition-colors hover:bg-accent hover:text-foreground"
                  aria-label={getAriaLabel(project.name, 'site')}
                >
                  <ExternalLinkIcon className="size-3.5 sm:size-4" />
                </a>
              )}
              {project.repository && (
                <a
                  href={project.repository}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="rounded-md p-1 text-muted-foreground transition-colors hover:bg-accent hover:text-foreground"
                  aria-label={getAriaLabel(project.name, 'repo')}
                >
                  <GitHubLogoIcon className="size-3.5 sm:size-4" />
                </a>
              )}
            </div>
          </div>
          <p class="text-xs leading-relaxed text-muted-foreground sm:text-sm">
            {project.description}
          </p>
          <div class="flex flex-wrap gap-1 sm:gap-1.5">
            {project.techStack.slice(0, 5).map((tech) => (
              <Badge variant="tech" className="text-2xs sm:text-xs">
                {tech}
              </Badge>
            ))}
            {project.techStack.length > 5 && (
              <span class="text-muted-foreground/60 px-1 py-0.5 text-2xs sm:text-xs">
                +{project.techStack.length - 5}
              </span>
            )}
          </div>
        </div>
      ))
    }
  </div>
</section>
