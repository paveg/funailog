---
/**
 * ReadingProgress â€” thin progress bar at the top of the page.
 * Shows how far the user has scrolled through the article.
 */
import { defaultLang } from '@/i18n/ui';
import { useTranslations } from '@/i18n/utils';

const t = useTranslations(defaultLang);
---

<div
  id="reading-progress"
  class="bg-foreground/20 fixed top-0 left-0 z-50 h-0.5 transition-[width] duration-75"
  style="width: 0%"
  role="progressbar"
  aria-label={t('a11y.readingProgress')}
  aria-valuemin="0"
  aria-valuemax="100"
  aria-valuenow="0"
>
</div>

<script>
  function initReadingProgress() {
    const bar = document.getElementById('reading-progress');
    const article = document.querySelector('article');
    if (!bar || !article) return;

    let ticking = false;

    const update = () => {
      const rect = article.getBoundingClientRect();
      const articleTop = rect.top + window.scrollY;
      const articleHeight = rect.height;
      const scrolled = window.scrollY - articleTop;
      const progress = Math.min(
        100,
        Math.max(0, (scrolled / (articleHeight - window.innerHeight)) * 100),
      );

      bar.style.width = `${progress}%`;
      bar.setAttribute('aria-valuenow', String(Math.round(progress)));
      ticking = false;
    };

    const onScroll = () => {
      if (!ticking) {
        requestAnimationFrame(update);
        ticking = true;
      }
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    update();
  }

  initReadingProgress();
  document.addEventListener('astro:after-swap', initReadingProgress);
</script>
