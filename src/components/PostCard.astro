---
import type { UnifiedPost } from '@/types/unified-post';

import { formatDateEn } from '@/lib/utils';

export type Props = {
  post: UnifiedPost;
  variant?: 'card' | 'list';
};

const { post, variant = 'list' } = Astro.props;

const heroImage =
  post.originalPost?.data.heroImage ??
  (post.collection && post.slug
    ? `/api/og/article/${post.collection}/${post.slug}.png`
    : undefined);

const effectiveVariant = variant === 'card' && heroImage ? 'card' : 'list';

const dateOnly = post.date.toISOString().slice(0, 10);
const lastUpdatedOnly = post.lastUpdated?.toISOString().slice(0, 10);
const hasDistinctUpdate = !!lastUpdatedOnly && lastUpdatedOnly !== dateOnly;
---

{
  effectiveVariant === 'card' ? (
    <article class="group">
      <a href={post.url} class="block">
        <div class="border-border bg-card overflow-hidden rounded-lg border transition-shadow duration-200 hover:shadow-md">
          {heroImage && (
            <div class="bg-muted aspect-[16/9] overflow-hidden">
              <img
                src={heroImage}
                alt=""
                class="size-full object-cover transition-transform duration-300 group-hover:scale-105"
                loading="lazy"
              />
            </div>
          )}
          <div class="p-4">
            <div class="font-code text-muted-foreground mb-2 flex items-center gap-2 text-xs">
              <span class="bg-muted rounded px-1.5 py-0.5 capitalize">
                {post.category}
              </span>
              <time datetime={post.date.toISOString()}>
                {formatDateEn(post.date)}
              </time>
              {hasDistinctUpdate && post.lastUpdated && (
                <time
                  datetime={post.lastUpdated.toISOString()}
                  class="text-muted-foreground/60"
                >
                  updated {formatDateEn(post.lastUpdated)}
                </time>
              )}
            </div>
            <h3 class="font-heading text-foreground group-hover:text-link line-clamp-2 text-lg transition-colors duration-150">
              {post.title}
            </h3>
            {post.description && (
              <p class="text-muted-foreground mt-2 line-clamp-2 text-sm">
                {post.description}
              </p>
            )}
          </div>
        </div>
      </a>
    </article>
  ) : (
    <article class="group">
      <a href={post.url} class="block">
        <div class="flex items-start gap-3">
          <div class="flex-1">
            <div class="font-code text-muted-foreground mb-1 flex items-center gap-2 text-xs">
              <span class="bg-muted rounded px-1.5 py-0.5 capitalize">
                {post.category}
              </span>
              <time datetime={post.date.toISOString()}>
                {formatDateEn(post.date)}
              </time>
              {hasDistinctUpdate && post.lastUpdated && (
                <time
                  datetime={post.lastUpdated.toISOString()}
                  class="text-muted-foreground/60"
                >
                  updated {formatDateEn(post.lastUpdated)}
                </time>
              )}
            </div>
            <h3 class="font-heading text-foreground group-hover:text-link transition-colors duration-150">
              {post.title}
            </h3>
          </div>
        </div>
      </a>
    </article>
  )
}
