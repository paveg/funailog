---
import { getEntry } from 'astro:content';

import CertificationsSection from '@/components/portfolio/CertificationsSection.astro';
import CVExportButton from '@/components/portfolio/CVExportButton.astro';
import EducationSection from '@/components/portfolio/EducationSection.astro';
import ProfileSection from '@/components/portfolio/ProfileSection.astro';
import ProjectsSection from '@/components/portfolio/ProjectsSection.astro';
import SkillsSection from '@/components/portfolio/SkillsSection.astro';
import WorkExperienceSection from '@/components/portfolio/WorkExperienceSection.astro';
import { useTranslations } from '@/i18n/utils';
import Layout from '@/layouts/Layout.astro';
import { BreadcrumbLd, ProfilePageLd } from '@/lib/rich-results';

const t = useTranslations('ja');
const site = Astro.site ?? '';
const meta = await getEntry('site', 'meta');
if (!meta) {
  throw new Error('Site meta configuration not found');
}
const portfolio = await getEntry('portfolio', 'profile');
const pageUrl = new URL('/portfolio', site).toString();
const homeUrl = new URL('/', site).toString();

if (!portfolio) {
  throw new Error('Portfolio data not found');
}
---

<Layout
  title={`Portfolio | ${t('main.title')}`}
  description={t('portfolio.description')}
  path="/portfolio"
  og={{ enabled: true }}
  hreflangs={[
    { path: '/portfolio', hreflang: 'ja' },
    { path: '/en/portfolio', hreflang: 'en' },
    { path: '/portfolio', hreflang: 'x-default' },
  ]}
  jsonLdSchema={[
    ProfilePageLd({
      name: t('portfolio.title'),
      description: t('portfolio.description'),
      url: pageUrl,
      meta,
      site,
    }),
    BreadcrumbLd([
      { name: t('main.title'), url: homeUrl },
      { name: t('portfolio.title'), url: pageUrl },
    ]),
  ]}
>
  <div class="space-y-12">
    <div class="flex justify-end">
      <a
        href="/en/portfolio"
        class="font-code text-muted-foreground hover:text-foreground text-xs transition-colors"
      >
        English &rarr;
      </a>
    </div>

    <ProfileSection profile={portfolio.data.profile} />

    <CVExportButton />

    <WorkExperienceSection items={portfolio.data.workExperience} />

    <ProjectsSection items={portfolio.data.projects} />

    <SkillsSection items={portfolio.data.skills} />

    {
      portfolio.data.certifications &&
        portfolio.data.certifications.length > 0 && (
          <CertificationsSection items={portfolio.data.certifications} />
        )
    }

    {
      portfolio.data.education && portfolio.data.education.length > 0 && (
        <EducationSection items={portfolio.data.education} />
      )
    }
  </div>
</Layout>
